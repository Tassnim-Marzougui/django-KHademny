{% load static %}
<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Postuler √† {{ offre.titre }} - Khademny</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <style>
    /* ====== (ŸÜŸÅÿ≥ CSS ŸÖÿ™ÿßÿπŸÉ ÿ™ŸÇÿ±Ÿäÿ®ÿßŸã) ====== */
    :root {
      --primary: #6C63FF;
      --secondary: #4A90E2;
      --accent: #FF6584;
      --success: #28a745;
      --warning: #ffc107;
      --danger: #dc3545;
      --dark: #121212;
      --darker: #0a0a0a;
      --light: #F8F9FA;
      --gray: #2d2d2d;
      --gradient: linear-gradient(135deg, #6C63FF 0%, #4A90E2 100%);
      --gradient-accent: linear-gradient(135deg, #FF6584 0%, #FF9A8B 100%);
    }
    *{margin:0;padding:0;box-sizing:border-box;font-family:'Poppins',sans-serif;}
    body{min-height:100vh;display:flex;flex-direction:column;background:var(--dark);color:var(--light);overflow-x:hidden;position:relative;}
    body::before{
      content:'';position:fixed;inset:0;
      background:
        radial-gradient(circle at 20% 80%, rgba(108, 99, 255, 0.3) 0%, transparent 50%),
        radial-gradient(circle at 80% 20%, rgba(255, 101, 132, 0.2) 0%, transparent 50%),
        radial-gradient(circle at 40% 40%, rgba(74, 144, 226, 0.25) 0%, transparent 50%);
      pointer-events:none;z-index:0;
      animation: float 8s ease-in-out infinite;
    }
    @keyframes float{0%,100%{transform:translateY(0) rotate(0)}50%{transform:translateY(-20px) rotate(180deg)}}

    .navbar{background:rgba(18,18,18,.95);backdrop-filter:blur(25px);border-bottom:1px solid rgba(255,255,255,.1);
      padding:1.2rem 2rem;position:sticky;top:0;z-index:1000;box-shadow:0 5px 25px rgba(0,0,0,.3);}
    .navbar-container{display:flex;justify-content:space-between;align-items:center;max-width:1400px;margin:0 auto;}
    .navbar-brand{display:flex;align-items:center;gap:12px;font-size:1.8rem;font-weight:700;background:var(--gradient);
      -webkit-background-clip:text;-webkit-text-fill-color:transparent;text-decoration:none;}
    .navbar-menu{display:flex;gap:2rem;align-items:center;}
    .navbar-link{color:rgba(255,255,255,.8);text-decoration:none;font-weight:500;font-size:1.1rem;padding:.5rem 1rem;border-radius:10px;transition:.3s;}
    .navbar-link:hover{color:#fff;background:rgba(108,99,255,.15);}
    .menu-toggle{display:none;background:none;border:none;color:#fff;font-size:1.5rem;cursor:pointer;}

    .main-content{flex:1;display:flex;justify-content:center;align-items:center;padding:40px 20px;position:relative;z-index:1;}
    .container{display:grid;grid-template-columns:1fr 1fr;gap:40px;width:100%;max-width:1200px;}
    .card{background:rgba(255,255,255,.08);backdrop-filter:blur(25px);border-radius:25px;padding:35px;border:1px solid rgba(255,255,255,.1);
      box-shadow:0 15px 35px rgba(0,0,0,.3),0 3px 10px rgba(255,255,255,.05) inset;position:relative;overflow:hidden;}
    .card::before{content:'';position:absolute;top:0;left:0;width:100%;height:5px;background:var(--gradient);}
    h2{text-align:center;margin-bottom:20px;font-size:1.8rem;font-weight:600;position:relative;padding-bottom:12px;}
    h2::after{content:'';position:absolute;bottom:0;left:50%;transform:translateX(-50%);width:60px;height:3px;background:var(--gradient);border-radius:2px;}

    .progress{height:28px;background:rgba(255,255,255,.1);border-radius:14px;overflow:hidden;margin-bottom:20px;border:1px solid rgba(255,255,255,.1);}
    .progress-bar{height:100%;line-height:28px;text-align:center;font-weight:600;color:#fff;transition:width 1.2s ease;}
    .bg-success{background:linear-gradient(135deg,#28a745,#20c997);}
    .bg-warning{background:linear-gradient(135deg,#ffc107,#fd7e14);}
    .bg-danger{background:linear-gradient(135deg,#dc3545,#e83e8c);}

    .badge{display:inline-block;background:var(--gradient);padding:10px 16px;border-radius:20px;margin:6px;color:#fff;font-weight:500;}
    .offer-info{color:rgba(255,255,255,.85);margin-bottom:18px;text-align:center;padding:12px;background:rgba(255,255,255,.05);border-radius:15px;border-left:4px solid var(--primary);}

    .input-group{position:relative;margin-bottom:18px;}
    .input-group i{position:absolute;top:50%;left:18px;transform:translateY(-50%);color:var(--primary);z-index:2;}
    .input-group input{width:100%;padding:14px 18px 14px 52px;border-radius:15px;background:rgba(255,255,255,.08);
      border:2px solid rgba(255,255,255,.1);color:#fff;outline:none;}
    .input-group input[type="file"]{padding:14px;cursor:pointer;}
    .input-group input[type="file"]::file-selector-button{
      background:var(--gradient);color:#fff;border:none;padding:10px 18px;border-radius:10px;margin-right:12px;cursor:pointer;
    }

    button{width:100%;padding:15px;border:none;border-radius:20px;background:var(--gradient);color:#fff;font-size:1.1rem;font-weight:600;cursor:pointer;}

    /* Django messages block */
    .messages{margin-bottom:18px;display:flex;flex-direction:column;gap:10px;}
    .msg{padding:12px 14px;border-radius:14px;border:1px solid rgba(255,255,255,.12);background:rgba(255,255,255,.06);}
    .msg.success{border-color:rgba(40,167,69,.35);color:#4ade80;}
    .msg.error{border-color:rgba(220,53,69,.35);color:#f87171;}
    .msg.info{border-color:rgba(255,193,7,.35);color:#fcd34d;}

    @media(max-width:768px){
      .container{grid-template-columns:1fr;}
      .menu-toggle{display:block;}
      .navbar-menu{display:none;flex-direction:column;width:100%;padding:1rem 0;}
      .navbar-menu.active{display:flex;}
      .navbar-container{flex-direction:column;gap:1rem;position:relative;}
    }
  </style>
</head>

<body>
  <nav class="navbar">
    <div class="navbar-container">
      <a href="/" class="navbar-brand"><i class="fas fa-gem"></i>Khademny</a>
      <button class="menu-toggle" id="menuToggle"><i class="fas fa-bars"></i></button>
      <div class="navbar-menu" id="navbarMenu">
        <a href="/" class="navbar-link"><i class="fas fa-home"></i>Accueil</a>
        <a href="/entreprises" class="navbar-link"><i class="fas fa-building"></i>Entreprises</a>
      </div>
    </div>
  </nav>

  <main class="main-content">
    <div class="container">

      <!-- R√©sultat compatibilit√© -->
      <div class="card">
        <h2>R√©sultat de compatibilit√©</h2>

        <!-- ‚úÖ Show Django messages HERE -->
        {% if messages %}
          <div class="messages">
            {% for message in messages %}
              <div class="msg {{ message.tags }}">{{ message }}</div>
            {% endfor %}
          </div>
        {% endif %}

        <div class="offer-info">
          <strong>Offre :</strong> "{{ offre.titre }}"
        </div>

        {% if score is not None %}
          <div class="progress">
            <div class="progress-bar
              {% if score >= 70 %}bg-success{% elif score >= 40 %}bg-warning{% else %}bg-danger{% endif %}"
              style="width: {{ score }}%;">
              {{ score|floatformat:0 }} %
            </div>
          </div>

          {% if score >= 70 %}
            <div class="msg success">Excellent Match üíö ‚Äî {{ score|floatformat:0 }} %</div>
          {% elif score >= 40 %}
            <div class="msg info">Match Moyen üü† ‚Äî {{ score|floatformat:0 }} %</div>
          {% else %}
            <div class="msg error">Faible Compatibilit√© üî¥ ‚Äî {{ score|floatformat:0 }} %</div>
          {% endif %}

          {% if found_skills %}
            <div style="margin-top:12px;">
              <strong>Comp√©tences d√©tect√©es :</strong><br>
              {% for skill in found_skills %}
                <span class="badge">{{ skill }}</span>
              {% endfor %}
            </div>
          {% endif %}
        {% else %}
          <div class="msg info" style="text-align:center;">
            Aucun score disponible. Veuillez uploader votre CV pour calculer la compatibilit√©.
          </div>
        {% endif %}
      </div>

      <!-- Formulaire candidat -->
      <div class="card">
        <h2>Formulaire Candidat</h2>
        <form method="POST" enctype="multipart/form-data" id="candidatForm">
          {% csrf_token %}

          <div class="input-group">
            <i class="fa fa-user"></i>
            <input type="text" name="nom" placeholder="Nom" required>
          </div>

          <div class="input-group">
            <i class="fa fa-user"></i>
            <input type="text" name="prenom" placeholder="Pr√©nom" required>
          </div>

          <div class="input-group">
            <i class="fa fa-envelope"></i>
            <input type="email" name="email" placeholder="Email" required>
          </div>

          <div class="input-group">
            <i class="fa fa-phone"></i>
            <input type="text" name="telephone" placeholder="T√©l√©phone">
          </div>

          <div class="input-group">
            <i class="fa fa-file"></i>
            <input type="file" name="cv" accept=".pdf,.doc,.docx" required>
            <small style="display:block;margin-top:8px;color:rgba(255,255,255,.55);">
              Formats accept√©s : PDF, DOC, DOCX (Max 5MB)
            </small>
          </div>

          <button type="submit">
            <i class="fas fa-paper-plane" style="margin-right:8px;"></i>
            Envoyer ma candidature
          </button>
        </form>
      </div>

    </div>
  </main>

  <script>
    // Mobile menu
    const menuToggle = document.getElementById('menuToggle');
    const navbarMenu = document.getElementById('navbarMenu');
    if (menuToggle && navbarMenu) {
      menuToggle.addEventListener('click', () => {
        navbarMenu.classList.toggle('active');
        menuToggle.innerHTML = navbarMenu.classList.contains('active')
          ? '<i class="fas fa-times"></i>'
          : '<i class="fas fa-bars"></i>';
      });
    }

    // File validation (keep)
    const fileInput = document.querySelector('input[type="file"]');
    if(fileInput) {
      fileInput.addEventListener('change', function() {
        const file = this.files[0];
        const maxSize = 5 * 1024 * 1024; // 5MB
        const allowedTypes = [
          'application/pdf',
          'application/msword',
          'application/vnd.openxmlformats-officedocument.wordprocessingml.document'
        ];

        if(file && file.size > maxSize) {
          Swal.fire({icon:'error',title:'Fichier trop volumineux',text:'La taille du fichier ne doit pas d√©passer 5MB.'});
          this.value = '';
        } else if(file && !allowedTypes.includes(file.type)) {
          Swal.fire({icon:'error',title:'Format non support√©',text:'Veuillez uploader un fichier PDF, DOC ou DOCX.'});
          this.value = '';
        }
      });
    }
  </script>
</body>
</html>
